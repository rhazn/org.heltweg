<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>
Run a personal Cloud with Traefik, Lets encrypt and Zookeeper | Philip Heltweg
</title>
<meta name=keywords content="kubernetes,docker,cloud,gke,gitlab,google cloud,devops,personal-cloud">
<meta name=description content="Run a personal Cloud with Traefik, Lets encrypt and Zookeeper"> <meta name=author content="Philip Heltweg"> <link rel=canonical href=https://heltweg.org/posts/run-a-personal-cloud-with-traefik-lets-encrypt-and-zookeeper/>
<script defer data-domain=heltweg.org src=https://plausible.io/js/plausible.js></script>
<link href=/assets/css/stylesheet.min.0009c85d6853c106e67556d2d8267107aa5a5adabd44b73921b9a91ce1f099e5.css integrity="sha256-AAnIXWhTwQbmdVbS2CZxB6paWtq9RLc5IbmpHOHwmeU=" rel="preload stylesheet" as=style>
<link rel=icon href=https://heltweg.org/img/favicon/favicon.ico> <link rel=icon type=image/png sizes=16x16 href=https://heltweg.org/img/favicon/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://heltweg.org/img/favicon/favicon-32x32.png>
<link rel=apple-touch-icon href=https://heltweg.org/img/favicon/apple-touch-icon.png> <link rel=mask-icon href=https://heltweg.org/img/favicon/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.88.0">
<meta property="og:title" content="Run a personal Cloud with Traefik, Lets encrypt and Zookeeper">
<meta property="og:description" content="Run a personal Cloud with Traefik, Lets encrypt and Zookeeper">
<meta property="og:type" content="article">
<meta property="og:url" content="https://heltweg.org/posts/run-a-personal-cloud-with-traefik-lets-encrypt-and-zookeeper/">
<meta property="og:image" content="https://heltweg.org/img/avatar.jpg">
<meta property="article:published_time" content="2019-08-16T00:00:00+00:00">
<meta property="article:modified_time" content="2019-08-16T00:00:00+00:00"><meta property="og:site_name" content="Philip Heltweg">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://heltweg.org/img/avatar.jpg">
<meta name=twitter:title content="Run a personal Cloud with Traefik, Lets encrypt and Zookeeper">
<meta name=twitter:description content="Run a personal Cloud with Traefik, Lets encrypt and Zookeeper">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://heltweg.org/posts/"},{"@type":"ListItem","position":3,"name":"Run a personal Cloud with Traefik, Lets encrypt and Zookeeper","item":"https://heltweg.org/posts/run-a-personal-cloud-with-traefik-lets-encrypt-and-zookeeper/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Run a personal Cloud with Traefik, Lets encrypt and Zookeeper","name":"Run a personal Cloud with Traefik, Lets encrypt and Zookeeper","description":"Kubernetes ingress with Traefik As mentioned in my last blog post I want to focus on a provider neutral setup for my own cloud, using technology that is not bound to any cloud ‚Ä¶","keywords":["kubernetes","docker","cloud","gke","gitlab","google cloud","devops","personal-cloud"],"articleBody":"Kubernetes ingress with Traefik As mentioned in my last blog post I want to focus on a provider neutral setup for my own cloud, using technology that is not bound to any cloud offering whenever possible.\nWhile google cloud offers load balanced HTTP ingress by default it is apparently very expensive in comparison to running small nodes and I have heard only good things about using Traefik for kubernetes ingress.\nFor setting up Traefik I followed Manuel‚Äôs excellent guide with minor modifications (you can find the final files at the end of the article.)\nHTTPs and Let‚Äôs encrypt Traefik has built-in support for automatically getting and renewing HTTPS certificates with Let‚Äôs Encrypt. As HTTPS is good practice and a requirement for HTTP2 and PWAs anyway I set it up using example configurations from the Traefik docs.\nBecause I was using just one node for Traefik I chose to go with the easy setup of a local acme.json file that stores the certificate while the node is running.\n.freelance { border: 1px var(--theme-color-foreground) solid; padding: 24px; margin: 24px; display: flex; flex-direction: column; align-items: center; } .freelance__button { background-color: var(--theme-color-background) !important; color: var(--theme-color-foreground) !important; background-color: red; padding: 1em 1.5em; text-decoration: none !important; display: block; max-width: 50%; text-align: center; margin: 1em; }  I am a freelancer and would love to help you! EMAIL ME üëã  GKE Preemptible nodes, your own chaos monkey To save costs I chose to use ‚ÄúPreemtible VMs‚Äù as nodes to power my kubernetes cluster on GKE. According to google‚Äôs docs: ‚ÄúPreemptible VMs are Google Compute Engine VM instances that last a maximum of 24 hours and provide no availability guarantees.‚Äù This means the nodes in my kubernetes cluster randomly go down and are never up more than 24h. While this obviously is not a smart decision for a production setup I have chosen to embrace it and consider the nodes going down my own ‚Äúchaos monkey‚Äù that forces me to write resilient code.\nA concrete example I ran into: The Let‚Äôs encrypt production API has a rate limit of requesting 5 certificates for the same URL in a week. Because my initial naive setup did not save the certificate anywhere it got lost whenever my Traefik node was terminated. While Traefik regenerates the certificate without any issue on startup‚Ä¶ after five startups I hit my rate limit and was greeted by an insecure warning without certificate.\nShared K/V store for Traefik with Zookeeper Enter a shared Key/Value store for Traefik. Using one is required if you want to run Traefik in cluster mode anyway (and I like to think my setup is easily scalable). It also means I can store my generated certificate in the K/V store where it will no longer just disappear when Traefik restarts.\nSince I have previous experience with Zookeeper and the setup was relatively painless I went with it.\nAll Kubernetes yaml files for the setup Finally the meat of the blog post, my complete setup as yaml files you can directly deploy into your GKE cluster:\nSet up Zookeeper first From this excellent ressource: https://github.com/kow3ns/kubernetes-zookeeper/blob/master/manifests/README.md\napiVersion: v1 kind: Service metadata: name: zk-hs labels: app: zk spec: ports: - port: 2888 name: server - port: 3888 name: leader-election clusterIP: None selector: app: zk --- apiVersion: v1 kind: Service metadata: name: zk-cs labels: app: zk spec: ports: - port: 2181 name: client selector: app: zk --- apiVersion: apps/v1beta1 kind: StatefulSet metadata: name: zk spec: serviceName: zk-hs replicas: 1 podManagementPolicy: Parallel updateStrategy: type: RollingUpdate template: metadata: labels: app: zk spec: affinity: podAntiAffinity: requiredDuringSchedulingIgnoredDuringExecution: - labelSelector: matchExpressions: - key: \"app\" operator: In values: - zk topologyKey: \"kubernetes.io/hostname\" containers: - name: kubernetes-zookeeper imagePullPolicy: Always image: \"gcr.io/google_containers/kubernetes-zookeeper:1.0-3.4.10\" resources: requests: memory: \"200M\" cpu: \"0.3\" ports: - containerPort: 2181 name: client - containerPort: 2888 name: server - containerPort: 3888 name: leader-election command: - sh - -c - \"start-zookeeper \\ --servers=1 \\ --data_dir=/var/lib/zookeeper/data \\ --data_log_dir=/var/lib/zookeeper/data/log \\ --conf_dir=/opt/zookeeper/conf \\ --client_port=2181 \\ --election_port=3888 \\ --server_port=2888 \\ --tick_time=2000 \\ --init_limit=10 \\ --sync_limit=5 \\ --heap=512M \\ --max_client_cnxns=60 \\ --snap_retain_count=3 \\ --purge_interval=12 \\ --max_session_timeout=40000 \\ --min_session_timeout=4000 \\ --log_level=INFO\" readinessProbe: exec: command: - sh - -c - \"zookeeper-ready 2181\" initialDelaySeconds: 10 timeoutSeconds: 5 livenessProbe: exec: command: - sh - -c - \"zookeeper-ready 2181\" initialDelaySeconds: 10 timeoutSeconds: 5 volumeMounts: - name: datadir mountPath: /var/lib/zookeeper securityContext: runAsUser: 1000 fsGroup: 1000 volumeClaimTemplates: - metadata: name: datadir spec: accessModes: [ \"ReadWriteOnce\" ] resources: requests: storage: 5Gi Permissions for Traefik # create Traefik cluster role kind: ClusterRole apiVersion: rbac.authorization.k8s.io/v1beta1 metadata: name: traefik-ingress-controller rules: - apiGroups: - \"\" resources: - services - endpoints - secrets verbs: - get - list - watch - apiGroups: - extensions resources: - ingresses verbs: - get - list - watch --- # create Traefik service account kind: ServiceAccount apiVersion: v1 metadata: name: traefik-ingress-controller namespace: default --- # bind role with service account kind: ClusterRoleBinding apiVersion: rbac.authorization.k8s.io/v1beta1 metadata: name: traefik-ingress-controller roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: traefik-ingress-controller subjects: - kind: ServiceAccount name: traefik-ingress-controller namespace: default Traefik config Note the configuration of zookeeper using the service address for the ‚Äúclient service‚Äù (cs) as well as the Let‚Äôs encrypt config here.\n# define Traefik configuration kind: ConfigMap apiVersion: v1 metadata: name: traefik-config data: traefik.toml: |# traefik.toml defaultEntryPoints = [\"http\", \"https\"] [entryPoints] [entryPoints.http] address = \":80\" [entryPoints.http.redirect] entryPoint = \"https\" [entryPoints.https] address = \":443\" [entryPoints.https.tls] [zookeeper] endpoint = \"zk-cs.default.svc.cluster.local:2181\" watch = true prefix = \"traefik\" [acme] email = \"your@email.com\" storage = \"traefik/acme/account\" onHostRule = true caServer = \"https://acme-v02.api.letsencrypt.org/directory\" acmeLogging = true entryPoint = \"https\" [acme.httpChallenge] entryPoint = \"http\" [[acme.domains]] main = \"your.domain.com\" Deployment for Traefik I run just one replica in here to save costs in my dev setup but I‚Äôve also scaled it up to three to test if it would stay up 100% of the time even with random nodes going down and everything works fine :).\n# declare Traefik deployment kind: Deployment apiVersion: extensions/v1beta1 metadata: name: traefik-ingress-controller spec: replicas: 1 template: metadata: labels: app: traefik-ingress-controller spec: serviceAccountName: traefik-ingress-controller terminationGracePeriodSeconds: 60 volumes: - name: config configMap: name: traefik-config containers: - name: traefik image: \"traefik:1.7.14\" volumeMounts: - mountPath: \"/etc/traefik/config\" name: config args: - --configfile=/etc/traefik/config/traefik.toml - --kubernetes - --logLevel=INFO Traefik service # Declare Traefik ingress service kind: Service apiVersion: v1 metadata: name: traefik-ingress-controller spec: selector: app: traefik-ingress-controller ports: - port: 80 name: http - port: 443 name: tls type: LoadBalancer .freelance { border: 1px var(--theme-color-foreground) solid; padding: 24px; margin: 24px; display: flex; flex-direction: column; align-items: center; } .freelance__button { background-color: var(--theme-color-background) !important; color: var(--theme-color-foreground) !important; background-color: red; padding: 1em 1.5em; text-decoration: none !important; display: block; max-width: 50%; text-align: center; margin: 1em; }  I am a freelancer and would love to help you! EMAIL ME üëã  Final result The final workloads with traefik and zookeeper\nAnd the kubernetes ingresses (ignore the app I used as demo for this).\nAbout Me More information on my Website. I love getting emails. Talk to me philip@heltweg.org or find me at @rhanarion. ","wordCount":"1135","inLanguage":"en","datePublished":"2019-08-16T00:00:00Z","dateModified":"2019-08-16T00:00:00Z","author":{"@type":"Person","name":"Philip Heltweg"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://heltweg.org/posts/run-a-personal-cloud-with-traefik-lets-encrypt-and-zookeeper/"},"publisher":{"@type":"Organization","name":"Philip Heltweg","logo":{"@type":"ImageObject","url":"https://heltweg.org/img/favicon/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<noscript>
<style type=text/css>#theme-toggle,.top-link{display:none}</style>
</noscript>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://heltweg.org accesskey=h title="Home (Alt + H)">
<img src=/img/favicon/apple-touch-icon.png alt=logo aria-label=logo height=35>Home</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu onscroll=menu_on_scroll()></ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
Run a personal Cloud with Traefik, Lets encrypt and Zookeeper
</h1>
<div class=post-description>
Run a personal Cloud with Traefik, Lets encrypt and Zookeeper
</div>
<div class=post-meta>
August 16, 2019&nbsp;¬∑&nbsp;6 min&nbsp;¬∑&nbsp;Philip Heltweg
</div>
</header>
<div class=toc>
<details open>
<summary accesskey=c title="(Alt + C)">
<div class=details>Table of Contents</div>
</summary>
<div class=inner><ul><li>
<a href=#kubernetes-ingress-with-traefik aria-label="Kubernetes ingress with Traefik">Kubernetes ingress with Traefik</a></li><li>
<a href=#https-and-lets-encrypt aria-label="HTTPs and Let&amp;rsquo;s encrypt">HTTPs and Let&rsquo;s encrypt</a></li><li>
<a href=#gke-preemptible-nodes-your-own-chaos-monkey aria-label="GKE Preemptible nodes, your own chaos monkey">GKE Preemptible nodes, your own chaos monkey</a></li><li>
<a href=#shared-kv-store-for-traefik-with-zookeeper aria-label="Shared K/V store for Traefik with Zookeeper">Shared K/V store for Traefik with Zookeeper</a></li><li>
<a href=#all-kubernetes-yaml-files-for-the-setup aria-label="All Kubernetes yaml files for the setup">All Kubernetes yaml files for the setup</a><ul>
<li>
<a href=#set-up-zookeeper-first aria-label="Set up Zookeeper first">Set up Zookeeper first</a></li><li>
<a href=#permissions-for-traefik aria-label="Permissions for Traefik">Permissions for Traefik</a></li><li>
<a href=#traefik-config aria-label="Traefik config">Traefik config</a></li><li>
<a href=#deployment-for-traefik aria-label="Deployment for Traefik">Deployment for Traefik</a></li><li>
<a href=#traefik-service aria-label="Traefik service">Traefik service</a></li></ul>
</li><li>
<a href=#final-result aria-label="Final result">Final result</a></li><li>
<a href=# aria-label="About Me">About Me</a></li></ul>
</div>
</details>
</div>
<div class=post-content>
<h1 id=kubernetes-ingress-with-traefik>Kubernetes ingress with Traefik<a hidden class=anchor aria-hidden=true href=#kubernetes-ingress-with-traefik>#</a></h1>
<p>As mentioned in my <a href=/posts/kubernetes-for-sideprojects-hardware-is-dead>last blog post</a> I want to focus on a provider neutral setup for my own cloud, using technology that is not bound to any cloud offering whenever possible.</p>
<p>While google cloud offers load balanced HTTP ingress by default it is apparently very expensive in comparison to running small nodes and I have heard only good things about using Traefik for kubernetes ingress.</p>
<p>For setting up Traefik I followed <a href=https://medium.com/google-cloud/traefik-on-a-google-kubernetes-engine-cluster-managed-by-terraform-ad871be8ee26>Manuel&rsquo;s excellent guide</a> with minor modifications (you can find the final files at the end of the article.)</p>
<h1 id=https-and-lets-encrypt>HTTPs and Let&rsquo;s encrypt<a hidden class=anchor aria-hidden=true href=#https-and-lets-encrypt>#</a></h1>
<p>Traefik has built-in support for automatically getting and renewing HTTPS certificates with <a href=https://letsencrypt.org/>Let&rsquo;s Encrypt</a>. As HTTPS is good practice and a requirement for HTTP2 and PWAs anyway I set it up using <a href=https://docs.traefik.io/user-guide/examples/#onhostrule-option-with-http-challenge>example configurations</a> from the Traefik docs.</p>
<p>Because I was using just one node for Traefik I chose to go with the easy setup of a local acme.json file that stores the certificate while the node is running.</p>
<style type=text/css>.freelance{border:1px var(--theme-color-foreground)solid;padding:24px;margin:24px;display:flex;flex-direction:column;align-items:center}.freelance__button{background-color:var(--theme-color-background)!important;color:var(--theme-color-foreground)!important;background-color:red;padding:1em 1.5em;text-decoration:none!important;display:block;max-width:50%;text-align:center;margin:1em}</style>
<div class=freelance>
<div>I am a freelancer and would love to help you!</div>
<a href=mailto:pheltweg@gmail.com class=freelance__button>EMAIL ME üëã</a>
</div>
<h1 id=gke-preemptible-nodes-your-own-chaos-monkey>GKE Preemptible nodes, your own chaos monkey<a hidden class=anchor aria-hidden=true href=#gke-preemptible-nodes-your-own-chaos-monkey>#</a></h1>
<p>To save costs I chose to use &ldquo;Preemtible VMs&rdquo; as nodes to power my kubernetes cluster on GKE. According to google&rsquo;s docs: &ldquo;Preemptible VMs are Google Compute Engine VM instances that last a maximum of 24 hours and provide no availability guarantees.&rdquo; This means the nodes in my kubernetes cluster randomly go down and are never up more than 24h. While this obviously is not a smart decision for a production setup I have chosen to embrace it and consider the nodes going down my own <a href=https://netflix.github.io/chaosmonkey/>&ldquo;chaos monkey&rdquo;</a> that forces me to write resilient code.</p>
<p>A concrete example I ran into: The Let&rsquo;s encrypt production API has a rate limit of requesting 5 certificates for the same URL in a week. Because my initial naive setup did not save the certificate anywhere it got lost whenever my Traefik node was terminated. While Traefik regenerates the certificate without any issue on startup&mldr; after five startups I hit my rate limit and was greeted by an insecure warning without certificate.</p>
<h1 id=shared-kv-store-for-traefik-with-zookeeper>Shared K/V store for Traefik with Zookeeper<a hidden class=anchor aria-hidden=true href=#shared-kv-store-for-traefik-with-zookeeper>#</a></h1>
<p>Enter a shared Key/Value store for Traefik. Using one is required if you want to run Traefik in cluster mode anyway (and I like to think my setup is easily scalable). It also means I can store my generated certificate in the K/V store where it will no longer just disappear when Traefik restarts.</p>
<p>Since I have previous experience with Zookeeper and the setup was relatively painless I went with it.</p>
<h1 id=all-kubernetes-yaml-files-for-the-setup>All Kubernetes yaml files for the setup<a hidden class=anchor aria-hidden=true href=#all-kubernetes-yaml-files-for-the-setup>#</a></h1>
<p>Finally the meat of the blog post, my complete setup as yaml files you can directly deploy into your GKE cluster:</p>
<h2 id=set-up-zookeeper-first>Set up Zookeeper first<a hidden class=anchor aria-hidden=true href=#set-up-zookeeper-first>#</a></h2>
<p>From this excellent ressource: <a href=https://github.com/kow3ns/kubernetes-zookeeper/blob/master/manifests/README.md>https://github.com/kow3ns/kubernetes-zookeeper/blob/master/manifests/README.md</a></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zk-hs</span>
  <span style=color:#f92672>labels</span>:
    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>zk</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>ports</span>:
  - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>2888</span>
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>server</span>
  - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>3888</span>
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>leader-election</span>
  <span style=color:#f92672>clusterIP</span>: <span style=color:#ae81ff>None</span>
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>zk</span>
---
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zk-cs</span>
  <span style=color:#f92672>labels</span>:
    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>zk</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>ports</span>:
  - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>2181</span>
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>client</span>
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>zk</span>
---
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1beta1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>StatefulSet</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zk</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>serviceName</span>: <span style=color:#ae81ff>zk-hs</span>
  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
  <span style=color:#f92672>podManagementPolicy</span>: <span style=color:#ae81ff>Parallel</span>
  <span style=color:#f92672>updateStrategy</span>:
    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>RollingUpdate</span>
  <span style=color:#f92672>template</span>:
    <span style=color:#f92672>metadata</span>:
      <span style=color:#f92672>labels</span>:
        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>zk</span>
    <span style=color:#f92672>spec</span>:
      <span style=color:#f92672>affinity</span>:
        <span style=color:#f92672>podAntiAffinity</span>:
          <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:
            - <span style=color:#f92672>labelSelector</span>:
                <span style=color:#f92672>matchExpressions</span>:
                  - <span style=color:#f92672>key</span>: <span style=color:#e6db74>&#34;app&#34;</span>
                    <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In</span>
                    <span style=color:#f92672>values</span>:
                    - <span style=color:#ae81ff>zk</span>
              <span style=color:#f92672>topologyKey</span>: <span style=color:#e6db74>&#34;kubernetes.io/hostname&#34;</span>
      <span style=color:#f92672>containers</span>:
      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>kubernetes-zookeeper</span>
        <span style=color:#f92672>imagePullPolicy</span>: <span style=color:#ae81ff>Always</span>
        <span style=color:#f92672>image</span>: <span style=color:#e6db74>&#34;gcr.io/google_containers/kubernetes-zookeeper:1.0-3.4.10&#34;</span>
        <span style=color:#f92672>resources</span>:
          <span style=color:#f92672>requests</span>:
            <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;200M&#34;</span>
            <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;0.3&#34;</span>
        <span style=color:#f92672>ports</span>:
        - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>2181</span>
          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>client</span>
        - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>2888</span>
          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>server</span>
        - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>3888</span>
          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>leader-election</span>
        <span style=color:#f92672>command</span>:
        - <span style=color:#ae81ff>sh</span>
        - -<span style=color:#ae81ff>c</span>
        - <span style=color:#e6db74>&#34;start-zookeeper \
</span><span style=color:#e6db74>          --servers=1 \
</span><span style=color:#e6db74>          --data_dir=/var/lib/zookeeper/data \
</span><span style=color:#e6db74>          --data_log_dir=/var/lib/zookeeper/data/log \
</span><span style=color:#e6db74>          --conf_dir=/opt/zookeeper/conf \
</span><span style=color:#e6db74>          --client_port=2181 \
</span><span style=color:#e6db74>          --election_port=3888 \
</span><span style=color:#e6db74>          --server_port=2888 \
</span><span style=color:#e6db74>          --tick_time=2000 \
</span><span style=color:#e6db74>          --init_limit=10 \
</span><span style=color:#e6db74>          --sync_limit=5 \
</span><span style=color:#e6db74>          --heap=512M \
</span><span style=color:#e6db74>          --max_client_cnxns=60 \
</span><span style=color:#e6db74>          --snap_retain_count=3 \
</span><span style=color:#e6db74>          --purge_interval=12 \
</span><span style=color:#e6db74>          --max_session_timeout=40000 \
</span><span style=color:#e6db74>          --min_session_timeout=4000 \
</span><span style=color:#e6db74>          --log_level=INFO&#34;</span>
        <span style=color:#f92672>readinessProbe</span>:
          <span style=color:#f92672>exec</span>:
            <span style=color:#f92672>command</span>:
            - <span style=color:#ae81ff>sh</span>
            - -<span style=color:#ae81ff>c</span>
            - <span style=color:#e6db74>&#34;zookeeper-ready 2181&#34;</span>
          <span style=color:#f92672>initialDelaySeconds</span>: <span style=color:#ae81ff>10</span>
          <span style=color:#f92672>timeoutSeconds</span>: <span style=color:#ae81ff>5</span>
        <span style=color:#f92672>livenessProbe</span>:
          <span style=color:#f92672>exec</span>:
            <span style=color:#f92672>command</span>:
            - <span style=color:#ae81ff>sh</span>
            - -<span style=color:#ae81ff>c</span>
            - <span style=color:#e6db74>&#34;zookeeper-ready 2181&#34;</span>
          <span style=color:#f92672>initialDelaySeconds</span>: <span style=color:#ae81ff>10</span>
          <span style=color:#f92672>timeoutSeconds</span>: <span style=color:#ae81ff>5</span>
        <span style=color:#f92672>volumeMounts</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>datadir</span>
          <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/var/lib/zookeeper</span>
      <span style=color:#f92672>securityContext</span>:
        <span style=color:#f92672>runAsUser</span>: <span style=color:#ae81ff>1000</span>
        <span style=color:#f92672>fsGroup</span>: <span style=color:#ae81ff>1000</span>
  <span style=color:#f92672>volumeClaimTemplates</span>:
  - <span style=color:#f92672>metadata</span>:
      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>datadir</span>
    <span style=color:#f92672>spec</span>:
      <span style=color:#f92672>accessModes</span>: [ <span style=color:#e6db74>&#34;ReadWriteOnce&#34;</span> ]
      <span style=color:#f92672>resources</span>:
        <span style=color:#f92672>requests</span>:
          <span style=color:#f92672>storage</span>: <span style=color:#ae81ff>5Gi</span>
</code></pre></div><h2 id=permissions-for-traefik>Permissions for Traefik<a hidden class=anchor aria-hidden=true href=#permissions-for-traefik>#</a></h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#75715e># create Traefik cluster role</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ClusterRole</span>
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>rbac.authorization.k8s.io/v1beta1</span>
<span style=color:#f92672>metadata</span>:
 <span style=color:#f92672>name</span>: <span style=color:#ae81ff>traefik-ingress-controller</span>
<span style=color:#f92672>rules</span>:
  - <span style=color:#f92672>apiGroups</span>:
      - <span style=color:#e6db74>&#34;&#34;</span>
    <span style=color:#f92672>resources</span>:
      - <span style=color:#ae81ff>services</span>
      - <span style=color:#ae81ff>endpoints</span>
      - <span style=color:#ae81ff>secrets</span>
    <span style=color:#f92672>verbs</span>:
      - <span style=color:#ae81ff>get</span>
      - <span style=color:#ae81ff>list</span>
      - <span style=color:#ae81ff>watch</span>
  - <span style=color:#f92672>apiGroups</span>:
      - <span style=color:#ae81ff>extensions</span>
    <span style=color:#f92672>resources</span>:
      - <span style=color:#ae81ff>ingresses</span>
    <span style=color:#f92672>verbs</span>:
      - <span style=color:#ae81ff>get</span>
      - <span style=color:#ae81ff>list</span>
      - <span style=color:#ae81ff>watch</span>
---
<span style=color:#75715e># create Traefik service account</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ServiceAccount</span>
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>traefik-ingress-controller</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
---
<span style=color:#75715e># bind role with service account</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ClusterRoleBinding</span>
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>rbac.authorization.k8s.io/v1beta1</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>traefik-ingress-controller</span>
<span style=color:#f92672>roleRef</span>:
  <span style=color:#f92672>apiGroup</span>: <span style=color:#ae81ff>rbac.authorization.k8s.io</span>
  <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ClusterRole</span>
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>traefik-ingress-controller</span>
<span style=color:#f92672>subjects</span>:
- <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ServiceAccount</span>
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>traefik-ingress-controller</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
</code></pre></div><h2 id=traefik-config>Traefik config<a hidden class=anchor aria-hidden=true href=#traefik-config>#</a></h2>
<p>Note the configuration of zookeeper using the service address for the &ldquo;client service&rdquo; (cs) as well as the Let&rsquo;s encrypt config here.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#75715e># define Traefik configuration</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ConfigMap</span>
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>traefik-config</span>
<span style=color:#f92672>data</span>:
  <span style=color:#f92672>traefik.toml</span>: |<span style=color:#e6db74>
</span><span style=color:#e6db74>    # traefik.toml
</span><span style=color:#e6db74>    defaultEntryPoints = [&#34;http&#34;, &#34;https&#34;]
</span><span style=color:#e6db74>    [entryPoints]
</span><span style=color:#e6db74>      [entryPoints.http]
</span><span style=color:#e6db74>        address = &#34;:80&#34;
</span><span style=color:#e6db74>        [entryPoints.http.redirect]
</span><span style=color:#e6db74>          entryPoint = &#34;https&#34;
</span><span style=color:#e6db74>      [entryPoints.https]
</span><span style=color:#e6db74>      address = &#34;:443&#34;
</span><span style=color:#e6db74>        [entryPoints.https.tls]
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>      [zookeeper]
</span><span style=color:#e6db74>        endpoint = &#34;zk-cs.default.svc.cluster.local:2181&#34;
</span><span style=color:#e6db74>        watch = true
</span><span style=color:#e6db74>        prefix = &#34;traefik&#34;
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>      [acme]
</span><span style=color:#e6db74>      email = &#34;your@email.com&#34;
</span><span style=color:#e6db74>      storage = &#34;traefik/acme/account&#34;
</span><span style=color:#e6db74>      onHostRule = true
</span><span style=color:#e6db74>      caServer = &#34;https://acme-v02.api.letsencrypt.org/directory&#34;
</span><span style=color:#e6db74>      acmeLogging = true
</span><span style=color:#e6db74>      entryPoint = &#34;https&#34;
</span><span style=color:#e6db74>        [acme.httpChallenge]
</span><span style=color:#e6db74>        entryPoint = &#34;http&#34;
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>      [[acme.domains]]
</span><span style=color:#e6db74>        main = &#34;your.domain.com&#34;</span>    
</code></pre></div><h2 id=deployment-for-traefik>Deployment for Traefik<a hidden class=anchor aria-hidden=true href=#deployment-for-traefik>#</a></h2>
<p>I run just one replica in here to save costs in my dev setup but I&rsquo;ve also scaled it up to three to test if it would stay up 100% of the time even with random nodes going down and everything works fine :).</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#75715e># declare Traefik deployment</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>extensions/v1beta1</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>traefik-ingress-controller</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
  <span style=color:#f92672>template</span>:
    <span style=color:#f92672>metadata</span>:
      <span style=color:#f92672>labels</span>:
        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>traefik-ingress-controller</span>
    <span style=color:#f92672>spec</span>:
      <span style=color:#f92672>serviceAccountName</span>: <span style=color:#ae81ff>traefik-ingress-controller</span>
      <span style=color:#f92672>terminationGracePeriodSeconds</span>: <span style=color:#ae81ff>60</span>
      <span style=color:#f92672>volumes</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>config</span>
          <span style=color:#f92672>configMap</span>:
            <span style=color:#f92672>name</span>: <span style=color:#ae81ff>traefik-config</span>
      <span style=color:#f92672>containers</span>:
      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>traefik</span>
        <span style=color:#f92672>image</span>: <span style=color:#e6db74>&#34;traefik:1.7.14&#34;</span>
        <span style=color:#f92672>volumeMounts</span>:
          - <span style=color:#f92672>mountPath</span>: <span style=color:#e6db74>&#34;/etc/traefik/config&#34;</span>
            <span style=color:#f92672>name</span>: <span style=color:#ae81ff>config</span>
        <span style=color:#f92672>args</span>:
        - --<span style=color:#ae81ff>configfile=/etc/traefik/config/traefik.toml</span>
        - --<span style=color:#ae81ff>kubernetes</span>
        - --<span style=color:#ae81ff>logLevel=INFO</span>
</code></pre></div><h2 id=traefik-service>Traefik service<a hidden class=anchor aria-hidden=true href=#traefik-service>#</a></h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#75715e># Declare Traefik ingress service</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>traefik-ingress-controller</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>traefik-ingress-controller</span>
  <span style=color:#f92672>ports</span>:
    - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>
      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>http</span>
    - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>443</span>
      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>tls</span>
  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>LoadBalancer</span>
</code></pre></div><style type=text/css>.freelance{border:1px var(--theme-color-foreground)solid;padding:24px;margin:24px;display:flex;flex-direction:column;align-items:center}.freelance__button{background-color:var(--theme-color-background)!important;color:var(--theme-color-foreground)!important;background-color:red;padding:1em 1.5em;text-decoration:none!important;display:block;max-width:50%;text-align:center;margin:1em}</style>
<div class=freelance>
<div>I am a freelancer and would love to help you!</div>
<a href=mailto:pheltweg@gmail.com class=freelance__button>EMAIL ME üëã</a>
</div>
<h1 id=final-result>Final result<a hidden class=anchor aria-hidden=true href=#final-result>#</a></h1>
<p>The final workloads with traefik and zookeeper</p>
<p><img src=/img/posts/run-a-personal-cloud-with-traefik-lets-encrypt-and-zookeeper/workloads.png#center alt="Traefik and Zookeeper workloads"></p>
<p>And the kubernetes ingresses (ignore the app I used as demo for this).</p>
<p><img src=/img/posts/run-a-personal-cloud-with-traefik-lets-encrypt-and-zookeeper/ingress.png#center alt="Kubernetes ingresses"></p>
<h1>About Me</h1>
<div>More information on my <a href=https://www.heltweg.org/>Website</a>. I love getting emails. Talk to me <a href=mailto:philip@heltweg.org>philip@heltweg.org</a> or find me at <a href=https://twitter.com/rhanarion>@rhanarion</a>.</div>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://heltweg.org/tags/kubernetes/>kubernetes</a></li>
<li><a href=https://heltweg.org/tags/docker/>docker</a></li>
<li><a href=https://heltweg.org/tags/cloud/>cloud</a></li>
<li><a href=https://heltweg.org/tags/gke/>gke</a></li>
<li><a href=https://heltweg.org/tags/gitlab/>gitlab</a></li>
<li><a href=https://heltweg.org/tags/google-cloud/>google cloud</a></li>
<li><a href=https://heltweg.org/tags/devops/>devops</a></li>
<li><a href=https://heltweg.org/tags/personal-cloud/>personal-cloud</a></li>
</ul>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share Run a personal Cloud with Traefik, Lets encrypt and Zookeeper on twitter" href="https://twitter.com/intent/tweet/?text=Run%20a%20personal%20Cloud%20with%20Traefik%2c%20Lets%20encrypt%20and%20Zookeeper&url=https%3a%2f%2fheltweg.org%2fposts%2frun-a-personal-cloud-with-traefik-lets-encrypt-and-zookeeper%2f&hashtags=kubernetes%2cdocker%2ccloud%2cgke%2cgitlab%2cgooglecloud%2cdevops%2cpersonal-cloud"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Run a personal Cloud with Traefik, Lets encrypt and Zookeeper on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fheltweg.org%2fposts%2frun-a-personal-cloud-with-traefik-lets-encrypt-and-zookeeper%2f&title=Run%20a%20personal%20Cloud%20with%20Traefik%2c%20Lets%20encrypt%20and%20Zookeeper&summary=Run%20a%20personal%20Cloud%20with%20Traefik%2c%20Lets%20encrypt%20and%20Zookeeper&source=https%3a%2f%2fheltweg.org%2fposts%2frun-a-personal-cloud-with-traefik-lets-encrypt-and-zookeeper%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Run a personal Cloud with Traefik, Lets encrypt and Zookeeper on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fheltweg.org%2fposts%2frun-a-personal-cloud-with-traefik-lets-encrypt-and-zookeeper%2f&title=Run%20a%20personal%20Cloud%20with%20Traefik%2c%20Lets%20encrypt%20and%20Zookeeper"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Run a personal Cloud with Traefik, Lets encrypt and Zookeeper on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fheltweg.org%2fposts%2frun-a-personal-cloud-with-traefik-lets-encrypt-and-zookeeper%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Run a personal Cloud with Traefik, Lets encrypt and Zookeeper on whatsapp" href="https://api.whatsapp.com/send?text=Run%20a%20personal%20Cloud%20with%20Traefik%2c%20Lets%20encrypt%20and%20Zookeeper%20-%20https%3a%2f%2fheltweg.org%2fposts%2frun-a-personal-cloud-with-traefik-lets-encrypt-and-zookeeper%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Run a personal Cloud with Traefik, Lets encrypt and Zookeeper on telegram" href="https://telegram.me/share/url?text=Run%20a%20personal%20Cloud%20with%20Traefik%2c%20Lets%20encrypt%20and%20Zookeeper&url=https%3a%2f%2fheltweg.org%2fposts%2frun-a-personal-cloud-with-traefik-lets-encrypt-and-zookeeper%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer>
</article>
</main><footer class=footer>
<span>&copy; 2022 <a href=https://heltweg.org>Philip Heltweg</a></span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)">
<button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</button>
</a>
<script defer src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position"))},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})});var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft)}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>